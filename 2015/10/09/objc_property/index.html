<!doctype html>
<html class="theme-next use-motion ">
<head>
	<!--为了使用aevit的js，需要预先加载jquery_20150722-->
	<script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>
    

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.4"/>


    <meta name="description" content="Hey! man~" />



  <meta name="keywords" content="Objective-C,iOS,开发," />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.4" />


<meta name="description" content="翻译自 Ry’s Objective-C Tutorial

一个对象的 property 能让其他对象检测或者改变该对象的状态。但是，一个设计良好的面向对象程序，应该避免直接让对象的内部状态被直接访问。相反，应该使用访问器方法(accessor methods, getters and setters)，来作为一种抽象，跟对象的底层数据进行交互。看图：

使用 accessor 方法来跟 pro">
<meta property="og:type" content="article">
<meta property="og:title" content="OC @property 知多少">
<meta property="og:url" content="http://pandara.xyz/2015/10/09/objc_property/index.html">
<meta property="og:site_name" content="Pandara's Zone">
<meta property="og:description" content="翻译自 Ry’s Objective-C Tutorial

一个对象的 property 能让其他对象检测或者改变该对象的状态。但是，一个设计良好的面向对象程序，应该避免直接让对象的内部状态被直接访问。相反，应该使用访问器方法(accessor methods, getters and setters)，来作为一种抽象，跟对象的底层数据进行交互。看图：

使用 accessor 方法来跟 pro">
<meta property="og:image" content="http://7ls0ue.com1.z0.glb.clouddn.com/2015/10/09/oc_property/accessor-methods.png">
<meta property="og:image" content="http://7ls0ue.com1.z0.glb.clouddn.com/2015/10/09/oc_property/object-ownership.png">
<meta property="og:image" content="http://7ls0ue.com1.z0.glb.clouddn.com/2015/10/09/oc_property/retain-cycle.png">
<meta property="og:image" content="http://7ls0ue.com1.z0.glb.clouddn.com/2015/10/09/oc_property/weak-reference.png">
<meta property="og:updated_time" content="2015-10-12T15:56:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OC @property 知多少">
<meta name="twitter:description" content="翻译自 Ry’s Objective-C Tutorial

一个对象的 property 能让其他对象检测或者改变该对象的状态。但是，一个设计良好的面向对象程序，应该避免直接让对象的内部状态被直接访问。相反，应该使用访问器方法(accessor methods, getters and setters)，来作为一种抽象，跟对象的底层数据进行交互。看图：

使用 accessor 方法来跟 pro">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'hide'
  };
</script>

    <title> OC @property 知多少 // Pandara's Zone </title>
    <link rel="shortcut icon" type="image/x-icon" href="http://7ls0ue.com1.z0.glb.clouddn.com/pandara_zone/favico%202.ico" media="screen" /> 
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?c5d0f36c537707dfe01cd190611c07b1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



<div class="container one-column page-post-detail">
    <div id="pandara-brand" class="my-brand">
      <div id="space-ship" class="pandara-image"></div>
      <div id="planet0" class="pandara-image"></div>
      <div id="earth" class="pandara-image"></div>
      <div id="planet1" class="pandara-image"></div>
      <div id="planet2" class="pandara-image"></div>
      <div id="planet3" class="pandara-image"></div>
      <div id="satellite" class="pandara-image"></div>
      <div id="planet4" class="pandara-image"></div>
      <div id="planet5" class="pandara-image"></div>
      <div id="planet6" class="pandara-image"></div>
    </div>
    <div class="headband"></div>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Pandara's Zone</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          
            <a href="/" rel="section">
              <i class="menu-item-icon icon-home"></i> <br />
              首页
            </a>
          
        </li>
      
        
        <li class="menu-item menu-item-categories">
          
            <a href="/categories" rel="section">
              <i class="menu-item-icon icon-categories"></i> <br />
              分类
            </a>
          
        </li>
      
        
        <li class="menu-item menu-item-about">
          
            <a href="/about.html" rel="section">
              <i class="menu-item-icon icon-about"></i> <br />
              (๑╹◡╹๑)
            </a>
          
        </li>
      
        
        <li class="menu-item menu-item-archives">
          
            <a href="/archives" rel="section">
              <i class="menu-item-icon icon-archives"></i> <br />
              归档
            </a>
          
        </li>
      
        
        <li class="menu-item menu-item-tags">
          
            <a href="/tags" rel="section">
              <i class="menu-item-icon icon-tags"></i> <br />
              标签
            </a>
          
        </li>
      
    </ul>
  

  
</nav>


        </div>
    </header>

    <main id="main" class="main">
        <div class="main-inner">
            <div id="content" class="content">
                

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              OC @property 知多少
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-10-09T00:00:00+08:00" content="2015-10-09">
            2015-10-09
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/你丫才码农/" itemprop="url" rel="index"><span itemprop="name">你丫才码农</span></a></span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/10/09/objc_property/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/09/objc_property/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        

        
          <span id="busuanzi_container_page_pv">
            &nbsp; | &nbsp;
            访客
            <span id="busuanzi_value_page_pv">0</span>
          </span>
        

       

      </div>
    </header>

    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><blockquote>
<p>翻译自 <a href="http://rypress.com/tutorials/objective-c/properties" target="_blank" rel="external">Ry’s Objective-C Tutorial</a></p>
</blockquote>
<p><br>一个对象的 property 能让其他对象检测或者改变该对象的状态。但是，一个设计良好的面向对象程序，应该避免直接让对象的内部状态被直接访问。相反，应该使用访问器方法(accessor methods, getters and setters)，来作为一种抽象，跟对象的底层数据进行交互。看图：</p>
<p><br><img src="http://7ls0ue.com1.z0.glb.clouddn.com/2015/10/09/oc_property/accessor-methods.png" alt="image"></p>
<center><em>使用 accessor 方法来跟 property 交互</em></center>

<a id="more"></a>
<p><br><strong>@property</strong>指令的目的，是通过自动生成这些 accessor 方法，来让这些 property 的创建以及设置变得简单。它允许你在语义层面(semantic level)上来指定 public property 的行为，并且它会承担相关的实现细节。</p>
<p><br><strong>@property</strong>指令中可以使用许多属性，来让你改变 getter 和 setter 的行为。有一些属性会决定 property 如何处理它们的底层内存，所以这篇文章也会同时介绍一些 Objective-C 内存管理。想要直到更多的关于内存管理的细节，可以阅读这里<a href="http://rypress.com/tutorials/objective-c/memory-management" target="_blank" rel="external">Memory Management</a>。</p>
<h4 id="@property_指令">@property 指令</h4><p>首先，让我们来瞧瞧当我们在使用<strong>@property</strong>指令的时候实际上在底层会发生什么事情。考虑如下例子，哟一个简单的 Car 类，还有它的相关实现。<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Car.h</span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> running;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Car.m</span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"Car.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Car</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> running = _running; <span class="comment">//Xcode 4.4+ 可以忽略</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>编译器会为 running 属性生成相应的 getter 还有 setter 方法。默认的命名惯例是，使用属性本身作为 getter 方法，在它的前面加上前缀 set 作为 setter 方法，在它前面加上下划线 _ 则是它的实例变量，如下：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)running &#123;</span><br><span class="line">	<span class="keyword">return</span> _reunning;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setRunning:(<span class="built_in">BOOL</span>)newValue &#123;</span><br><span class="line">	_running = newValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在使用<strong>@property</strong>指令声明了属性之后，你就可以调用这些 setter getter 方法了，就好像他们在你的 .h 跟 .m 文件被编写进去了一样。你也可以在 Car.m 文件里面重写它们来提供自定义的 getter/setter 方法，但如果这样的话就必须要编写 @synthesize 指令的相关代码了(???)。然而，你已经很少情况需要自定义 accessor 方法，因为<strong>@property</strong>能让你在一个抽象层面完成这些工作。</p>
<p><br>通过点运算符来访问的属性会根据所在的场景，被翻译成对应的 accessor 方法。所以下面的代码中的 honda.running 语句，在你向它分配一个值时实际上是在调用 <code>setRunning:</code> ，当你读取它的值时实际上是在调用 <code>running</code> 方法。<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.m</span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"Car.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">	<span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">		Car *honda = [[Car alloc] init];</span><br><span class="line">		honda<span class="variable">.runing</span> = <span class="literal">YES</span>; <span class="comment">// [honda setRunning: YES];</span></span><br><span class="line">		<span class="built_in">NSLog</span>(<span class="string">@"%d"</span>, honda<span class="variable">.running</span>); <span class="comment">// [honda running]</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>要改变自动生成的 accessor 的行为，你可以在<strong>@property</strong>指令后面的圆括号指定一些属性。这篇文章剩下的部分将会介绍这些可用的属性。</p>
<h4 id="getter=_跟_setter=">getter= 跟 setter=</h4><p>如果你不喜欢<strong>@property</strong>默认的命名规范，你可以通过 <code>getter=</code> 还有 <code>setter=</code> 这两个属性来改变 getter 跟 setter 方法的名字。通常我们会在 Boolean 类型的 property 中使用，因为它们的 getter 按照惯例通常会有 is 作为前缀。例子如下：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (getter=isRunning) <span class="built_in">BOOL</span> running;</span><br></pre></td></tr></table></figure></p>
<p>现在，生成的 accessor 就会被命名为 isRunning 跟 setRunning 方法。要注意，property 的名字仍然为 running，并且这是你应该在点运算符后面使用的：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Car *honda = [[Car alloc] init];</span><br><span class="line">honda<span class="variable">.running</span> = <span class="literal">YES</span>; <span class="comment">// [honda setRunning: YES]</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%d"</span>, honda<span class="variable">.running</span>); <span class="comment">// [honda isRunning]</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%d"</span>, [honda running]); <span class="comment">// Error: method no longer exists</span></span><br></pre></td></tr></table></figure></p>
<p>它们俩是唯一带参数的属性——accessor 方法的名字。剩下的其他属性都是 Boolean 标识。</p>
<h4 id="readonly">readonly</h4><p>readonly 属性能让一个属性变成只读。它删除了 setter 方法并且禁止通过点运算符来对属性分配值，但是 getter 不会受影响。举个栗子，让我们像下面的代码那样修改 Car 类。注意如何通过逗号来分割指定的多个属性。<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (getter=isRunning, <span class="keyword">readonly</span>) <span class="built_in">BOOL</span> running;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)startEngine;</span><br><span class="line">- (<span class="keyword">void</span>)stopEngine;</span><br></pre></td></tr></table></figure></p>
<p>我们通过 startEngine 跟 stopEngine 方法的实现，来在类内部设置 running property，而不是让其他对象直接显式对它进行修改。相关的方法实现如下：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Car.m</span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"Car.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Car</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)startEngine &#123;</span><br><span class="line">	_running = <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)stopEngine &#123;</span><br><span class="line">	_running = <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>记住，<strong>@property</strong>同时也为我们生成一个实例变量，这就是为什么我们可以方位 _running 而不用在某处显式声明它。在上面的程序中，我们不能用 <code>self.running</code> 来对 _running 分配值，因为 running property 是 readonly 的。我们可以在 main.m 中添加如下代码片段来测试新的 Car 类。<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Car *honda = [[Car alloc] init]</span><br><span class="line">[honda startEngine];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Running: %d"</span>, honda<span class="variable">.running</span>);</span><br><span class="line">honda<span class="variable">.running</span> = <span class="literal">NO</span>; <span class="comment">// Error: read-only property</span></span><br></pre></td></tr></table></figure></p>
<p>直到这里，property 对我们来说仅仅是让我们避免编写四班的 getter 跟 setter 方法。但是对于剩下的 attribute 来说就不是这样了，它们会明显地改变 property 的行为。同时，它们只能在 Objective-C 对象类型的 property 中使用，而在原始的 C 数据类型中则不可使用。</p>
<h4 id="nonatomic">nonatomic</h4><p><strong>原子性(Atomicity)</strong>跟 property 在一个线程环境中的行为有关。当你拥有不止一个线程，可能在某个时间点，setter 跟 getter 会被同时调用。这就意味着，getter/setter 能被另外一个 setter/getter 操作打断，而因此导致数据冲突。</p>
<p><br>atomic property 会将底层对象锁住来阻止这种情况发生，保证了 get 或者 set 操作工作时对象的值是完整的。然而，重要的是，这只是线程安全的一个方面，并不是说使用 atomic property 就意味着你的代码一定是线程安全的。</p>
<p><br>使用<strong>@property</strong>声明的property默认具有 atomic 属性，并且这会导致一些开销。所以，如果你并不是在多线程环境（或者你正在实现自己的线程安全），你可以用 nonatomic 属性来重写这个行为，如下：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *model;</span><br></pre></td></tr></table></figure></p>
<p>这里有一些关于 atomic property 的小小警告。Atomic property 的 accessor 方法（getter和setter）需要<em>成对</em>地<strong>被自动生成</strong>或者<strong>用户自己定义</strong>。换句话说，你要么不定义，要定义就将 setter 跟 getter 一起定义。只有 non-atomic property 才能让你混搭 synthesized accessor 跟自定义的 accessor 方法。想清楚地了解，你可以将上面代码里面的 nonatomic 移除，然后再 Car.m 里面添加自定义的 getter 方法。</p>
<h4 id="内存管理">内存管理</h4><p>在所有面向对象编程（OOP）语言中，对象存在于计算机的内存中，而内存是稀缺资源，在移动设备中尤为这样。内存管理系统的目的是，以一种有效率的方法，来确保程序不会占有的内存空间不会比他们实际所需要的更多。</p>
<p><br>很多语言通过垃圾回收机制来实现内存管理，但是 Objective-C 使用一种更加有效率的替代方法，称为 <strong>对象拥有关系（object ownership）</strong>。当你开始与一个对象进行交互，你会被认为拥有（own）该对象，这意味着只要你在使用着它，它就会一直存在。当你完成操作之后，你将释放对该对象的拥有关系（ownship）。而在释放了之后，如果该对象没有其他 owner，操作系统将会销毁该对象，并且释放底层的内存空间。</p>
<p><br><img src="http://7ls0ue.com1.z0.glb.clouddn.com/2015/10/09/oc_property/object-ownership.png" alt="image"></p>
<center><em>销毁没有 owner 的对象</em></center>

<p><br>而在 <strong>Automatic Reference Counting</strong> 出现之后，编译器将自动管理你的所有对象 ownership 。这就意味着，在大多数情况下，你将不再需要担忧系统实际上如何进行内存管理。但是，你应该了解 <strong>@property</strong> 里面的 strong，weak 和 copy 这几个属性，因为他们会告诉编译器相应的对象之间会拥有怎样的关系。</p>
<h5 id="strong">strong</h5><p>strong 属性会对被分配到 property 的对象创建拥有关系（owning relationship）。这是所有对象类型的 property 的默认属性，同时也是安全的默认属性，因为它确保了被分配给 property 的对象不会意外被释放。</p>
<p><br>下面通过一个新的 Person 类来观察它是怎样使用的。Person 类仅生命了一个 name property：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person.h</span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>它的实现如下。Person 类使用<strong>@property</strong>生成的默认 accesor 方法。它同时重写了 NSObject 的 description 方法，该方法将返回一个代表该对象的字符串。<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person.m</span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"Person.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)description &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">self</span><span class="variable">.name</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>下一步，让我们在 Car 类中添加一个 Person 类型的 property。将 Car.h 修改如下：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Car.h</span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"Person.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *model;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Person *driver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>然后，考虑在 main.m 中的如下代码：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.m</span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"Car.h"</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"Persion.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">	<span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">		Person *john = [[Person alloc] <span class="keyword">int</span>];</span><br><span class="line">		john<span class="variable">.name</span> = <span class="string">@"John"</span>;</span><br><span class="line"></span><br><span class="line">		Car *honda = [[Car alloc] init];</span><br><span class="line">		honda<span class="variable">.model</span> = <span class="string">@"Honda Civic"</span>;</span><br><span class="line">		honda<span class="variable">.driver</span> = john;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">NSLog</span>(<span class="string">@"%@ is driving the %@"</span>, honda<span class="variable">.driver</span>, honda<span class="variable">.model</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>由于 driver 是强关系（strong relationship），对象 honda 拥有 john 的 ownership ，这保证了只要 honda 需要它，就不会被释放掉。</p>
<h5 id="weak">weak</h5><p>strong 属性是 object property 中使用得最普遍的。然而 strong reference 会引来一个问题。例如，当我们需要引用 driver 正在驾驶的 Car 对象。首先，让我们在 Person.h 中增加一个 Car 类型 property：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person.h</span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Car</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Car *car;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p><code>@class Car</code> 代码行是对 Car 类的超前声明（forward declaration）。它像是在告诉编译器：“相信我，Car 类是存在的，所以现在先不要试图马上去寻找它”。我们使用这行代码，而不是使用我们习惯的 <code>#import</code> 语句，是因为 Car 同样也 import Person.h，否则将会导致一个无穷无尽的 import 循环。（编译器不喜欢 endless loop）</p>
<p><br>下一步，在 honda.driver 赋值语句后面加入下面代码：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">honda<span class="variable">.driver</span> = john;</span><br><span class="line">john<span class="variable">.car</span> = honda; <span class="comment">// Add this line</span></span><br></pre></td></tr></table></figure></p>
<p>我们现在有从 honda 指向 john 的关系，同时也有从 john 到 honda 的关系。这就意味着双方<strong>彼此拥有</strong>，因此内存管理系统永远不能释放他们，即使他们不再被需要。</p>
<p><br><img src="http://7ls0ue.com1.z0.glb.clouddn.com/2015/10/09/oc_property/retain-cycle.png" alt="image"><br><em>在 Car 跟 Person 类之间的 retain cycle</em></p>
<p><br>这被称为 <strong>retain cycle</strong> ，是一种内存泄露，如我们所知内存泄露是多么的糟糕。幸运的是，要解决这个问题非常简单，只需要让其中一个 property 对其对象的引用更改为 <strong>weak<br> reference</strong>。在 Person.h，如下更改 car property 的声明。<br> <figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) Car *car;</span><br></pre></td></tr></table></figure></p>
<p> weak 属性创建了一种对 car 的“非拥有关系（non-owning relationship）”。这允许 john 拥有指向 honda 的关系，同时避免了 retain cycle。但是，这也同时可能会导致这样的一种情况：john 仍然持有指向 honda 的引用，但是 honda 已经被销毁了。如果这种情况发生了， weak 属性会贴心地将 car 设置为 nil，来避免悬空指针（dangling pointer）出现。</p>
<p><br><img src="http://7ls0ue.com1.z0.glb.clouddn.com/2015/10/09/oc_property/weak-reference.png" alt="image"><br><em>从 Person 类指向 Car 类的 weak reference</em></p>
<p><br>一种普遍的使用 weak 属性的场景是在父子关系的数据结构中。一般情况下，父对象应该持有指向孩子的 strong reference，而子对象应该持有指向父对象的 weak reference。weak reference 同样也是在 delegate 设计模式中固有的一部分。</p>
<p><br>值得再次提醒，两个对象之间不应该彼此持有指向对方的 strong reference。weak 属性让我们得以维持一个循环的指向关系但是不会引入 retain cycle。</p>
<h5 id="copy">copy</h5><p>copy 属性是 strong 的另一种替代方式。copy 会对分配给 property 的对象创建一个拷贝，然后持有该拷贝的 ownership，而不是持有原对象的 ownership。只有遵从了 NSCopying 协议的对象能使用它。</p>
<p><br>代表值的 property（而不是连接或者引用）可以使用 copy 属性。例如，开发者通常拷贝 NSString property 而不是持有它们的 strong reference：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Car.h</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *model;</span><br></pre></td></tr></table></figure></p>
<p>现在，Car 会持有我们分配给 model 的对象的一个新拷贝的 strong reference。如果你 working with mutable values，这样做有一个好处：copy 让你得以“冷藏”该可变值，让 property 持有被赋值时的值，而后面原可变值如何改变都不再影响此 property。例子如下：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.m</span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"Car.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> *argv[]) &#123;</span><br><span class="line">	<span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">		Car *honda = [[Car alloc] init];</span><br><span class="line">		<span class="built_in">NSMutableString</span> *model = [<span class="built_in">NSMutableString</span> stringWithString:<span class="string">@"Honda Civic"</span>];</span><br><span class="line">		honda<span class="variable">.model</span> = model;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, honda<span class="variable">.model</span>);</span><br><span class="line">		[model setString:<span class="string">@"Nissa Versa"</span>];</span><br><span class="line">		<span class="built_in">NSLog</span>(<span class="string">"%@"</span>, honda<span class="variable">.model</span>); <span class="comment">// Still "Honda Civic"</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>NSMutableString</strong> 是 NSString 的子类，它可被修改。如果 model 属性没有创建对原对象的拷贝，我们将会看到 NSLog 打印出来的内容为“Nissa Versa”。</p>
<h4 id="Other_Attributes">Other Attributes</h4><p>上面提到的 <strong>@property</strong> 的 attribute 是你现在设计 Objective-C 应用所需要的（iOS5+），但还有一些其他的 attribute，你可能会在一些比较旧的库或者文档中遇到。</p>
<h5 id="retain">retain</h5><p>retain 属性是 MRR（Manual Retain Release） 版本的 strong，它会产生相同的作用：获得被分配的值的 ownership。在 ARC 环境下你不应该使用这个值。</p>
<h5 id="unsafe_unretained">unsafe_unretained</h5><p>使用 unsafe_unretained 属性的 property 跟使用 weak 属性的 property 类似，但是它在引用的对象被销毁的时候并不会自动将 property 设置为 nil。你唯一一个使用 unsafe_unretained 的理由应该是——你在不支持 weak 属性的环境中编码。</p>
<h5 id="assign">assign</h5><p>assign 属性在 property 被赋予一个新的值时，不会执行任何内存管理的调用。这是原始数据类型 property 的默认属性。在 iOS5 之前，它也被用来作为 weak reference 的一种实现方式。像 retain 一样，你不应该在 ARC 环境中使用它。用于OC对象时，<code>assign</code> 跟 <code>weak</code> 类似，但是在所指向的对象被销毁之后，不会将 property 清空。</p>
<h4 id="总结">总结</h4><table>
<thead>
<tr>
<th>Attribute</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>getter=</td>
<td>为 getter 方法取一个自定义的名字</td>
</tr>
<tr>
<td>setter=</td>
<td>为 setter 方法取一个自定义的名字</td>
</tr>
<tr>
<td>readonly</td>
<td>编译器不会为你生成 setter 方法</td>
</tr>
<tr>
<td>nonatomic</td>
<td>不保证在多线程环境中，对属性的访问的完整性。但它比默认的 atomic 更加高效</td>
</tr>
<tr>
<td>strong</td>
<td>在 property 与被分配的值之间创建拥有关系。它是 object property 的默认属性</td>
</tr>
<tr>
<td>weak</td>
<td>在 property 与被分配的值之间创建非拥有关系。用它来避免 retain cycle</td>
</tr>
<tr>
<td>copy</td>
<td>创建被分配的值的拷贝，而不是直接引用原对象</td>
</tr>
</tbody>
</table>
<p><br><br>以上</p>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Objective-C/" rel="tag">#Objective-C</a>
          
            <a href="/tags/iOS/" rel="tag">#iOS</a>
          
            <a href="/tags/开发/" rel="tag">#开发</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/10/10/code_night_thinking/" rel="prev">冷夜随喷</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/10/06/kingsman/" rel="next">像个英国绅士般优雅地爆头</a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


            </div>

            

            
              <div class="comments" id="comments">
                
                  <div class="ds-thread" data-thread-key="2015/10/09/objc_property/"
                       data-title="OC @property 知多少" data-url="http://pandara.xyz/2015/10/09/objc_property/">
                  </div>
                
              </div>
            
        </div>

        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <div class="site-author-avatar"></div>
          <p class="site-author-name" itemprop="name">Pandara</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Hey! man~</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">58</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">6</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">38</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/PandaraWen" target="_blank">Github</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/pandarawen" target="_blank">Weibo</a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">基情链接</p>
            
              <span class="links-of-author-item">
              <a href="http://aevit.xyz/" target="_blank">Aevit's Lab</a>
              </span>
            
              <span class="links-of-author-item">
              <a href="http://helkyle.com/" target="_blank">HelKyle's blog</a>
              </span>
            
              <span class="links-of-author-item">
              <a href="http://w3ctrain.com" target="_blank">W3cTrain</a>
              </span>
            
          
        </div>

      </section>

      
        <section class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#@property_指令"><span class="nav-number">1.</span> <span class="nav-text">@property 指令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getter=_跟_setter="><span class="nav-number">2.</span> <span class="nav-text">getter= 跟 setter=</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#readonly"><span class="nav-number">3.</span> <span class="nav-text">readonly</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nonatomic"><span class="nav-number">4.</span> <span class="nav-text">nonatomic</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#内存管理"><span class="nav-number">5.</span> <span class="nav-text">内存管理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#strong"><span class="nav-number">5.1.</span> <span class="nav-text">strong</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#weak"><span class="nav-number">5.2.</span> <span class="nav-text">weak</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#copy"><span class="nav-number">5.3.</span> <span class="nav-text">copy</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Other_Attributes"><span class="nav-number">6.</span> <span class="nav-text">Other Attributes</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#retain"><span class="nav-number">6.1.</span> <span class="nav-text">retain</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#unsafe_unretained"><span class="nav-number">6.2.</span> <span class="nav-text">unsafe_unretained</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#assign"><span class="nav-number">6.3.</span> <span class="nav-text">assign</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结"><span class="nav-number">7.</span> <span class="nav-text">总结</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

      <div class="side-bar-foot-decorate">
        <div class="side-bar-man motion-element"></div>
        <div class="side-bar-star motion-element"></div>
      </div>
    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
        <div class="footer-inner">
            <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Pandara</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



        </div>
    </footer>

    <div class="back-to-top"></div>
</div>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"pandara"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    

    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.4"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.4"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.4" id="motion.global"></script>



  <script type="text/javascript" src="/js/search-toggle.js"></script>


  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.4" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;
          var self = this;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      $(indicator).velocity('stop').velocity({
        opacity: action === 'show' ? 0.4 : 0
      }, { duration: 100 });
    }

  });
</script>


  <script type="text/javascript" id="sidebar.nav">
    $(document).ready(function () {
      var html = $('html');

      $('.sidebar-nav li').on('click', function () {
        var item = $(this);
        var activeTabClassName = 'sidebar-nav-active';
        var activePanelClassName = 'sidebar-panel-active';
        if (item.hasClass(activeTabClassName)) {
          return;
        }

        var currentTarget = $('.' + activePanelClassName);
        var target = $('.' + item.data('target'));

        currentTarget.velocity('transition.slideUpOut', 200, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', 200)
            .addClass(activePanelClassName);
        });

        item.siblings().removeClass(activeTabClassName);
        item.addClass(activeTabClassName);
      });

      $('.post-toc a').on('click', function (e) {
        e.preventDefault();
        var offset = $(escapeSelector(this.getAttribute('href'))).offset().top;
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        });
      });

      // Expand sidebar on post detail page by default, when post has a toc.
      var $tocContent = $('.post-toc-content');
      if (isDesktop() && CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    });
  </script>




<script type="text/javascript">
    $(document).ready(function () {
        if (CONFIG.sidebar === 'always') {
            displaySidebar();
        }
    });
</script>








<!-- lazyload -->
<script type="text/javascript" src="/js/lazyload.js"></script>
<script type="text/javascript">
    jQuery(function () {
        jQuery("#posts img").lazyload({
            placeholder: "/images/loading.gif",
            effect: "fadeIn"
        });
    });
</script>
</body>
</html>